#!/bin/sh

ppq_parse package < package.ppq

projname="$config__package__name"
version="$config__package__version"
lib="$config__package__lib"
bin="$config__package__bin"

echo "cmake_minimum_required(VERSION 3.1)"
echo ""
echo "project($projname VERSION $version LANGUAGES CXX)"
echo ""
echo "add_library($lib)"
echo "target_include_directories($lib PUBLIC"
echo "    \$<BUILD_INTERFACE:\${CMAKE_CURRENT_SOURCE_DIR}/include>"
echo "    \$<INSTALL_INTERFACE:include>)"
echo "target_sources($lib PRIVATE"
echo "    src/$projname/lib.cpp)"
echo ""
echo "add_executable(${projname}-bin src/main.cpp)"
echo "set_target_properties(${projname}-bin"
echo "    PROPERTIES OUTPUT_NAME $bin)"
echo "target_link_libraries(${projname}-bin"
echo "    $lib)"
echo ""
echo "install(TARGETS $lib ${projname}-bin"
echo "    EXPORT ${projname}-config"
echo "    ARCHIVE DESTINATION lib"
echo "    LIBRARY DESTINATION lib"
echo "    RUNTIME DESTINATION bin)"
echo ""
echo "install(EXPORT ${projname}-config"
echo "    NAMESPACE ${projname}"
echo "    DESTINATION lib/cmake/$projname)"
echo ""
echo "include(CMakePackageConfigHelpers)"
echo ""
echo "write_basic_package_version_file("
echo "    \${CMAKE_CURRENT_BINARY_DIR}/${projname}-config-version.cmake"
echo "    COMPATIBILITY SameMajorVersion)"
echo ""
echo "install(FILES \${CMAKE_CURRENT_BINARY_DIR}/${projname}-config-version.cmake"
echo "    DESTINATION lib/cmake/$projname)"
echo "install(DIRECTORY \${CMAKE_CURRENT_SOURCE_DIR}/include/"
echo "    DESTINATION include)"
echo ""
echo "if(CMAKE_PROJECT_NAME STREQUAL PROJECT_NAME)"
echo "    include(CTest)"
echo "    if(BUILD_TESTING)"
echo "        add_subdirectory(test)"
echo "    endif()"
echo "endif()"
